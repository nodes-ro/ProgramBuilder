{% if program %}
<h3 style="margin-bottom: 1rem;">{{ program.name }}</h3>

<div class="tabs">
  <!-- Tab Navigation -->
  <nav role="tablist">
    <ul>
      {% for day in program.days %}
      {% set tab_id = day.day | lower | replace(" ", "_") %}
      <li><a href="#{{ tab_id }}" role="tab" {% if loop.first %}class="active"{% endif %}>{{ day.day }}</a></li>
      {% endfor %}
    </ul>
  </nav>

  <!-- Tab Content Sections -->
  {% for day in program.days %}
  {% set tab_id = day.day | lower | replace(" ", "_") %}
  {% set start_hour = day.day_start.split(':')[0] | int %}
  {% set end_hour = day.day_ends.split(':')[0] | int %}
  {% set stage_count = day.stage_count | int %}

  <section id="{{ tab_id }}" role="tabpanel" {% if not loop.first %}style="display:none;"{% endif %}>
    <h4>{{ day.day }}</h4>

    <table>
      <thead>
        <tr>
          <th>Time</th>
          {% for stage in range(1, stage_count + 1) %}
          <th>Stage {{ stage }}</th>
          {% endfor %}
        </tr>
      </thead>
 <tbody>
  {% for hour in range(start_hour, end_hour) %}
  <tr>
    <td>{{ "%02d:00" % hour }}</td>
    {% for stage in range(1, stage_count + 1) %}
    <td>
      {% for event in events %}
        {% if event.day == day.day
               and event.stage|int == stage
               and event.event_start.split(':')[0]|int == hour %}
          <strong>{{ event.title }}</strong><br>
          <em>{{ event.detail }}</em>
        {% endif %}
      {% endfor %}
    </td>
    {% endfor %}
  </tr>
  {% endfor %}
</tbody>

    </table>
  </section>
  {% endfor %}
</div>

<!-- Tab Switching Script -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll("nav[role=tablist] a");
    const panels = document.querySelectorAll("section[role=tabpanel]");

    tabs.forEach(tab => {
      tab.addEventListener("click", e => {
        e.preventDefault();
        const targetId = tab.getAttribute("href").substring(1);
        panels.forEach(panel => panel.style.display = "none");
        tabs.forEach(t => t.classList.remove("active"));
        document.getElementById(targetId).style.display = "block";
        tab.classList.add("active");
      });
    });
  });
</script>

<!-- Optional CSS -->
<style>
  nav[role=tablist] a.active {
    font-weight: bold;
    border-bottom: 2px solid currentColor;
  }
  td {
    vertical-align: top;
  }
</style>
{% else %}
<p>No program yet.</p>
{% endif %}
